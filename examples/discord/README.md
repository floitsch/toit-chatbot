# Discord Chat Bot

A simple Discord chat bot using OpenAI's API that runs on an ESP32 (or
  desktop if you prefer).

## Setup
### Toit
Make sure you have [Toit](toitlang.org) installed. The easiest is to use
  [Jaguar](https://github.com/toitlang/jaguar).

Install the dependencies (in this directory; or add `--project_root=<DIR>`).
- with Jaguar: `jag pkg install`
- with pure Toit: `toit.pkg install`

If you are using Jaguar (preferred), flash it to your device:
- `jag flash`

### OpenAI
Create an account at https://platform.openai.com/, and create an API key
in the [api-keys page](https://platform.openai.com/account/api-keys).

### Discord
Create a new application on the [Discord Developer Portal](https://discord.com/developers/applications).

Go to the 'Bot' tab (on the left) and click on 'Add Bot', followed by 'Yes, do it!'.

Depending on your preferences make the bot public or private. Since you are
paying for the OpenAI API calls, you probably want to make it private.

Make sure to enable the priviliged gateway intents. Specifically, you need
the 'Message Content Intent' (and maybe 'Server Members Intent' as well).

Click on the 'Reset Token' (next to the Icon) and copy/save the token.

Go to the OAuth2 tab (on the left) and go to URL Generator. Select the
'bot' scope (and no other) with the following permissions:
- Read Messages/View Channels
- Send Messages
- Send Messages in Threads

Copy/save the generated URL.

## Running locally
Set the following environment variables:
- `OPENAI_API_KEY`: your OpenAI API key
- `DISCORD_TOKEN`: the token provided by Discord
- `DISCORD_URL`: optional; the URL generated by Discord

Run the bot:
- with Jaguar: `jag run -d host main.toit`
- with pure Toit: `toit.run main.toit`

## Running on an ESP32
Take the provided `esp32-example.toit` and copy/rename it to
`esp32.toit` (or `esp32_<suffix>.toit` if you want to
run multiple bots).

Change the credentials in that file, then do the usual Jaguar installation
steps:
* optionally start the serial monitor: `jag monitor`
* run the bot: `jag run esp32.toit`

If you want to install the bot so it runs on boot:
* install the bot: `jag container install bot esp32.toit`

## Support
If you have questions, please ask on the [Toit Discord](https://discord.gg/Q7Y9VQ5nh2).
